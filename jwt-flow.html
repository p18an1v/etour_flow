<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JWT Auth ‚Äî Simply Explained</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',sans-serif;background:#080c14;color:#e2e8f0;min-height:100vh;-webkit-font-smoothing:antialiased;padding-bottom:60px}
    code{font-family:'JetBrains Mono',monospace;font-size:.88em;background:rgba(255,255,255,.07);padding:1px 5px;border-radius:4px}
    .nav{background:#0a0f1c;border-bottom:1px solid rgba(255,255,255,.07);padding:12px 16px;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:50}
    .back{font-size:12px;color:#64748b;text-decoration:none}
    .nav-title{font-size:13px;font-weight:700;color:#fcd34d}
    .nav-sub{font-size:10px;color:#334155;margin-left:auto}
    .page{max-width:680px;margin:0 auto;padding:20px 14px}
    .intro{background:#0e1420;border:1px solid rgba(245,158,11,.2);border-radius:14px;padding:18px;margin-bottom:20px}
    .intro h2{font-size:17px;font-weight:800;color:#fcd34d;margin-bottom:8px}
    .intro p{font-size:12px;color:#94a3b8;line-height:1.7}
    .secret-box{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.3);border-radius:12px;padding:14px 16px;margin-bottom:20px;text-align:center}
    .secret-box .label{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#78350f;margin-bottom:8px}
    .secret-box .key{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:#fcd34d;word-break:break-all}
    .secret-box p{font-size:10px;color:#713f12;margin-top:6px}

    .step{margin-bottom:8px;border-radius:14px;border:1px solid rgba(255,255,255,.07);background:#0e1420;overflow:hidden}
    .step.open{border-color:rgba(245,158,11,.3)}
    .step-btn{display:flex;align-items:center;gap:12px;padding:14px 16px;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;width:100%;background:none;border:none;color:inherit;text-align:left}
    .num{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;flex-shrink:0}
    .step-icon{font-size:20px;flex-shrink:0}
    .step-text{flex:1}
    .step-title{font-size:13px;font-weight:700}
    .step-hint{font-size:10px;color:#64748b;margin-top:2px}
    .caret{color:#334155;transition:transform .2s;flex-shrink:0}
    .open .caret{transform:rotate(180deg)}
    .step-body{display:none;padding:0 16px 16px;border-top:1px solid rgba(255,255,255,.05)}
    .eli5{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.2);border-radius:10px;padding:11px 13px;font-size:11px;color:#fde68a;line-height:1.6;margin-top:12px}
    .eli5 strong{font-weight:700}
    .code-block{background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:11px 13px;font-size:10.5px;font-family:'JetBrains Mono',monospace;line-height:1.75;overflow-x:auto;margin-top:10px;white-space:pre}
    .lbl{font-size:9px;font-weight:700;letter-spacing:1.4px;text-transform:uppercase;color:#334155;margin:13px 0 7px}
    .green-box{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.2);border-radius:9px;padding:10px 12px;font-size:10.5px;color:#86efac;margin-top:10px;line-height:1.6}
    .red-box{background:rgba(244,63,94,.07);border:1px solid rgba(244,63,94,.2);border-radius:9px;padding:10px 12px;font-size:10.5px;color:#fda4af;margin-top:10px;line-height:1.6}

    /* JWT visual */
    .jwt-visual{display:flex;flex-direction:column;gap:6px;margin:12px 0}
    .jwt-part{border-radius:9px;padding:10px 12px;font-size:11px;line-height:1.6}
    .jp-h{background:rgba(244,63,94,.1);border:1px solid rgba(244,63,94,.25)}.jp-h .jlbl{color:#fda4af}
    .jp-p{background:rgba(14,165,233,.1);border:1px solid rgba(14,165,233,.25)}.jp-p .jlbl{color:#7dd3fc}
    .jp-s{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.25)}.jp-s .jlbl{color:#fcd34d}
    .jlbl{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}

    /* Side-by-side compare */
    .cmp{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
    .cmp-box{border-radius:9px;padding:10px 12px;font-size:10px;line-height:1.7;font-family:'JetBrains Mono',monospace}
    .cmp-j{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.2)}
    .cmp-n{background:rgba(124,58,237,.07);border:1px solid rgba(124,58,237,.2)}
    .cmp-lbl{font-size:9px;font-weight:700;text-transform:uppercase;margin-bottom:6px}
    .cmp-j .cmp-lbl{color:#86efac}
    .cmp-n .cmp-lbl{color:#c4b5fd}
    .cmp-j pre,.cmp-n pre{color:#94a3b8;white-space:pre-wrap;word-break:break-all}

    /* num colours */
    .n1 .num{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.n1 .step-title{color:#fcd34d}
    .n2 .num{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.n2 .step-title{color:#86efac}
    .n3 .num{background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff}.n3 .step-title{color:#7dd3fc}
    .n4 .num{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff}.n4 .step-title{color:#c4b5fd}
    .n5 .num{background:linear-gradient(135deg,#f43f5e,#e11d48);color:#fff}.n5 .step-title{color:#fda4af}
    .n6 .num{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.n6 .step-title{color:#6ee7b7}
    .n7 .num{background:linear-gradient(135deg,#64748b,#475569);color:#fff}.n7 .step-title{color:#94a3b8}

    .cmt{color:#334155}.key{color:#7dd3fc}.fn{color:#86efac}.str{color:#fcd34d}.val{color:#f9a8d4}
    footer{text-align:center;font-size:10px;color:#1e293b;padding:24px 14px}
  </style>
</head>
<body>

<nav class="nav">
  <a class="back" href="index.html">‚Üê Home</a>
  <span class="nav-title">üîë JWT Auth Flow</span>
  <span class="nav-sub">Tap a step to expand</span>
</nav>

<div class="page">

  <div class="intro">
    <h2>ü§î What is JWT and why do we use it?</h2>
    <p>JWT = <strong>JSON Web Token</strong>. After you log in, the server gives you a special ticket (JWT). Every time you make a request, you show that ticket. The server trusts it without checking the database again ‚Äî it's <strong>stateless</strong>.</p>
  </div>

  <div class="secret-box">
    <div class="label">üîë Shared Secret Key (both Java &amp; .NET use the same!)</div>
    <div class="key">"MySecretKeyForJwt123456789012345"</div>
    <p>Because the key is the same, a token created by Java can be read by .NET and vice versa</p>
  </div>

  <!-- STEP 1: Structure -->
  <div class="step n1 open">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">1</div>
      <span class="step-icon">üß¨</span>
      <div class="step-text">
        <div class="step-title">What does a JWT look like?</div>
        <div class="step-hint">3 parts joined by dots ‚Äî Header.Payload.Signature</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5"><strong>Analogy:</strong> Think of a JWT like a sealed envelope with your name written outside. Anyone can read the name (payload), but only the post office (server) can create the official seal (signature) ‚Äî and that seal proves it wasn't tampered with.</div>
      <div style="background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:11px 13px;margin-top:12px;font-size:10px;font-family:'JetBrains Mono',monospace;word-break:break-all;line-height:1.7">
        <span style="color:#fda4af">eyJhbGciOiJIUzI1NiJ9</span><span style="color:#334155">.</span><span style="color:#7dd3fc">eyJzdWIiOiJ1c2VyQGIuY29tIiwicm9sZSI6IkNVU1RPTUVSIiwiZXhwIjoxNzM0MDAwMDAwfQ</span><span style="color:#334155">.</span><span style="color:#fcd34d">aBcDeFg...signature</span>
      </div>
      <div class="jwt-visual">
        <div class="jwt-part jp-h">
          <div class="jlbl">üî¥ Part 1 ‚Äî Header (red)</div>
          Algorithm used: <strong>HS256</strong><br/>Type: <strong>JWT</strong>
        </div>
        <div class="jwt-part jp-p">
          <div class="jlbl">üîµ Part 2 ‚Äî Payload (blue) = the data</div>
          <code>sub</code> = user's email (who they are)<br/>
          <code>role</code> = CUSTOMER or admin<br/>
          <code>iat</code> = when token was created<br/>
          <code>exp</code> = when token expires ‚Üê <strong>24 hours</strong>
        </div>
        <div class="jwt-part jp-s">
          <div class="jlbl">üü° Part 3 ‚Äî Signature (gold)</div>
          HMAC-SHA256 of (Header + Payload) using the secret key.<br/>
          <strong>If anyone changes the payload, this signature breaks!</strong>
        </div>
      </div>
      <div class="red-box">‚ö†Ô∏è The payload is NOT encrypted ‚Äî it's just Base64 encoded. Anyone can decode and read it. Never put passwords in JWT!</div>
    </div>
  </div>

  <!-- STEP 2: Token Creation -->
  <div class="step n2">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">2</div>
      <span class="step-icon">üè≠</span>
      <div class="step-text">
        <div class="step-title">Token Creation ‚Äî on Login</div>
        <div class="step-hint">After verifying credentials, the server builds the JWT</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5"><strong>After the server checks your password is correct</strong>, it creates a JWT with your email and role inside, signs it with the secret key, and sends it back. You keep this token and use it for all future requests.</div>
      <div class="cmp">
        <div class="cmp-box cmp-j">
          <div class="cmp-lbl">‚òï Java ‚Äî JwtUtil.java</div>
          <pre>Jwts.builder()
  .setSubject(email)
  .claim("role", role)
  .setExpiration(+24h)
  .signWith(key, HS256)
  .compact();</pre>
        </div>
        <div class="cmp-box cmp-n">
          <div class="cmp-lbl">üí† .NET ‚Äî JwtService.cs</div>
          <pre>new JwtSecurityToken(
  claims: [sub,role],
  expires: +24h,
  signingCredentials: creds
);
handler.WriteToken(token);</pre>
        </div>
      </div>
      <div class="green-box">‚úÖ Response to login: <code>{"token": "eyJhbGci..."}</code></div>
    </div>
  </div>

  <!-- STEP 3: Storing + Sending the token -->
  <div class="step n3">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">3</div>
      <span class="step-icon">üì§</span>
      <div class="step-text">
        <div class="step-title">Storing &amp; Sending the Token</div>
        <div class="step-hint">Frontend saves token, attaches it to every protected request</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5"><strong>Analogy:</strong> After login, you get a wristband üé´ (JWT). You keep it in your pocket (localStorage). Every time you enter a protected area, you show the wristband ‚Äî the staff doesn't need to look you up again.</div>
      <div class="lbl">Step 1 ‚Äî Save the token after login</div>
      <div class="code-block"><span class="cmt">// Frontend (React/JS)</span>
const response = await fetch(<span class="str">'/api/auth/login'</span>, {
  method: <span class="str">'POST'</span>,
  body: JSON.stringify({ email, password })
});
const { token } = await response.json();
localStorage.setItem(<span class="str">'token'</span>, token);  <span class="cmt">// save it!</span></div>
      <div class="lbl">Step 2 ‚Äî Send it with every protected request</div>
      <div class="code-block"><span class="cmt">// Every API call that needs auth</span>
const token = localStorage.getItem(<span class="str">'token'</span>);
fetch(<span class="str">'/api/bookings/customer/5'</span>, {
  headers: {
    <span class="str">'Authorization'</span>: <span class="str">`Bearer ${token}`</span>
    <span class="cmt">//  ‚Üë MUST be "Bearer " (capital B, space, then token)</span>
  }
})</div>
      <div class="lbl">What the HTTP header looks like</div>
      <div class="code-block">GET /api/bookings/customer/5 HTTP/1.1
<span class="str">Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIi...</span></div>
    </div>
  </div>

  <!-- STEP 4: Server reads token -->
  <div class="step n4">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">4</div>
      <span class="step-icon">üîç</span>
      <div class="step-text">
        <div class="step-title">Server Reads &amp; Validates Token</div>
        <div class="step-hint">JwtAuthFilter (Java) or JwtMiddleware (.NET)</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5"><strong>The same process on both backends:</strong><br/>1. Read the <code>Authorization</code> header<br/>2. Remove "Bearer " prefix to get the raw token<br/>3. Verify the signature hasn't been tampered<br/>4. Check it hasn't expired<br/>5. Extract email + role from the payload<br/>6. Make user identity available to the controller</div>
      <div class="cmp">
        <div class="cmp-box cmp-j">
          <div class="cmp-lbl">‚òï Java result</div>
          <pre>SecurityContextHolder
  .getContext()
  .setAuthentication(
    authToken);</pre>
        </div>
        <div class="cmp-box cmp-n">
          <div class="cmp-lbl">üí† .NET result</div>
          <pre>ctx.Items["UserEmail"]
  = email;
ctx.Items["UserRole"]
  = role;</pre>
        </div>
      </div>
      <div class="lbl">What happens if token is invalid?</div>
      <div style="background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:12px;font-size:11px;line-height:1.9">
        <div>‚ùå <strong style="color:#fda4af">No token</strong> ‚Üí identity NOT set ‚Üí controller gets null user</div>
        <div>‚ùå <strong style="color:#fda4af">Expired token</strong> ‚Üí signature check fails ‚Üí identity NOT set</div>
        <div>‚ùå <strong style="color:#fda4af">Tampered token</strong> ‚Üí signature mismatch ‚Üí identity NOT set</div>
        <div>‚úÖ <strong style="color:#86efac">Valid token</strong> ‚Üí email + role stored ‚Üí controller runs normally</div>
      </div>
    </div>
  </div>

  <!-- STEP 5: Authorization -->
  <div class="step n5">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">5</div>
      <span class="step-icon">üö¶</span>
      <div class="step-text">
        <div class="step-title">Authorization ‚Äî Role Checks</div>
        <div class="step-hint">Who is allowed to do what based on their role</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5"><strong>Authentication</strong> = "Who are you?" (is your token valid?)<br/><strong>Authorization</strong> = "What are you ALLOWED to do?" (is your role allowed here?)<br/><br/>In our project, roles are: <code>CUSTOMER</code> and <code>admin</code>.</div>
      <div class="lbl">Java ‚Äî role check in controller</div>
      <div class="code-block"><span class="cmt">// Spring Security reads from SecurityContextHolder</span>
<span class="key">@PreAuthorize</span>(<span class="str">"hasRole('CUSTOMER')"</span>)
<span class="key">@GetMapping</span>(<span class="str">"/my-bookings"</span>)
public ResponseEntity getMyBookings(Authentication auth) {
  String email = auth.getName();  <span class="cmt">// email from JWT</span>
  return ResponseEntity.ok(bookingService.<span class="fn">getByEmail</span>(email));
}</div>
      <div class="lbl">.NET ‚Äî role check in controller</div>
      <div class="code-block"><span class="cmt">// .NET reads from HttpContext.Items</span>
<span class="key">[HttpGet]</span>(<span class="str">"my-bookings"</span>)
public async Task&lt;IActionResult&gt; GetMyBookings() {
  var role = HttpContext.Items[<span class="str">"UserRole"</span>]?.ToString();

  if (role != <span class="str">"CUSTOMER"</span>)
    return Unauthorized();  <span class="cmt">// 401 ‚Äî wrong role</span>

  var email = HttpContext.Items[<span class="str">"UserEmail"</span>]?.ToString();
  return Ok(await _service.<span class="fn">GetByEmailAsync</span>(email));
}</div>
    </div>
  </div>

  <!-- STEP 6: Token Expiry -->
  <div class="step n6">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">6</div>
      <span class="step-icon">‚è±Ô∏è</span>
      <div class="step-text">
        <div class="step-title">Token Expiry</div>
        <div class="step-hint">24h for login, 15 minutes for password reset</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5"><strong>Tokens automatically expire</strong> ‚Äî so even if someone steals your token, it only works for a limited time. Our project uses different expiry times depending on the use case.</div>
      <div style="background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:12px;margin-top:12px">
        <table style="width:100%;font-size:11px;border-collapse:collapse">
          <tr style="border-bottom:1px solid rgba(255,255,255,.07)">
            <th style="text-align:left;color:#334155;padding:6px 8px;font-size:10px;text-transform:uppercase;letter-spacing:1px">Token Type</th>
            <th style="text-align:left;color:#334155;padding:6px 8px;font-size:10px;text-transform:uppercase;letter-spacing:1px">Expiry</th>
            <th style="text-align:left;color:#334155;padding:6px 8px;font-size:10px;text-transform:uppercase;letter-spacing:1px">Used for</th>
          </tr>
          <tr style="border-bottom:1px solid rgba(255,255,255,.03)">
            <td style="padding:6px 8px;color:#fcd34d">Login JWT</td>
            <td style="padding:6px 8px;color:#86efac">24 hours</td>
            <td style="padding:6px 8px;color:#64748b">All API calls after login</td>
          </tr>
          <tr>
            <td style="padding:6px 8px;color:#fda4af">Reset Password JWT</td>
            <td style="padding:6px 8px;color:#f97316">15 minutes</td>
            <td style="padding:6px 8px;color:#64748b">One-time password reset link</td>
          </tr>
        </table>
      </div>
      <div class="green-box" style="margin-top:10px">‚úÖ After 24h, the user gets a 401 Unauthorized ‚Üí frontend redirects to login screen ‚Üí user logs in again to get a fresh token.</div>
    </div>
  </div>

  <!-- STEP 7: Google OAuth -->
  <div class="step n7">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">7</div>
      <span class="step-icon">üåê</span>
      <div class="step-text">
        <div class="step-title">Google OAuth + JWT</div>
        <div class="step-hint">Login with Google ‚Äî still ends up with our own JWT</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5"><strong>Google OAuth doesn't replace JWT</strong> ‚Äî it's just another way to verify your identity. After Google confirms "yes, this is a real Google account", our server issues our own JWT ‚Äî and from that point, everything works exactly the same as normal login.</div>
      <div style="background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:12px;margin-top:12px;font-size:11px;line-height:2.2">
        <div><span style="color:#7dd3fc">‚ë† </span>User clicks "Sign in with Google"</div>
        <div><span style="color:#7dd3fc">‚ë° </span>Google verifies identity ‚Üí gives frontend a <strong style="color:#fcd34d">Google ID Token</strong></div>
        <div><span style="color:#7dd3fc">‚ë¢ </span>Frontend sends Google ID Token to <code>POST /api/auth/google-login</code></div>
        <div><span style="color:#7dd3fc">‚ë£ </span>Backend verifies the Google token (using Google's public API)</div>
        <div><span style="color:#7dd3fc">‚ë§ </span>Backend extracts email from Google token ‚Üí checks if user exists in <code>customer_master</code></div>
        <div><span style="color:#7dd3fc">‚ë• </span>Backend generates <strong style="color:#86efac">our own JWT</strong> using the same secret key</div>
        <div><span style="color:#7dd3fc">‚ë¶ </span>Returns <code>{"token": "eyJ..."}</code> ‚Äî frontend uses it exactly like a normal login</div>
      </div>
    </div>
  </div>

  <!-- SUMMARY -->
  <div class="lbl" style="margin-top:20px">üó∫Ô∏è Complete JWT Life Cycle</div>
  <div style="background:#0e1420;border:1px solid rgba(245,158,11,.2);border-radius:12px;padding:16px;font-size:11px;line-height:2.2">
    <div><span style="color:#fcd34d">1.</span> User logs in ‚Üí server checks password in DB ‚úì</div>
    <div><span style="color:#fcd34d">2.</span> Server creates JWT with email + role, signs with secret key</div>
    <div><span style="color:#fcd34d">3.</span> Response: <code>{"token": "eyJ..."}</code> ‚Üí frontend saves in localStorage</div>
    <div><span style="color:#fcd34d">4.</span> Every next request: frontend adds <code>Authorization: Bearer eyJ...</code></div>
    <div><span style="color:#fcd34d">5.</span> Filter/Middleware reads header ‚Üí validates ‚Üí extracts email + role</div>
    <div><span style="color:#fcd34d">6.</span> Controller uses email/role ‚Üí calls service ‚Üí returns data ‚Üí JSON response</div>
    <div><span style="color:#fcd34d">7.</span> After 24h token expires ‚Üí 401 ‚Üí user must login again</div>
  </div>

</div>

<footer><a href="index.html" style="color:#334155;text-decoration:none">‚Üê Back to Home</a> &nbsp;¬∑&nbsp; JWT ¬∑ HS256 ¬∑ 24h expiry ¬∑ Java + .NET</footer>

<script>
  function tog(btn){btn.closest('.step').classList.toggle('open')}
</script>
</body>
</html>
