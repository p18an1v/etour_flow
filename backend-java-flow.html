<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Java Spring Boot ‚Äî How a Request Works</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',sans-serif;background:#080c14;color:#e2e8f0;min-height:100vh;-webkit-font-smoothing:antialiased;padding-bottom:60px}
    code{font-family:'JetBrains Mono',monospace;font-size:.88em;background:rgba(255,255,255,.07);padding:1px 5px;border-radius:4px}

    /* NAV */
    .nav{background:#0a0f1c;border-bottom:1px solid rgba(255,255,255,.07);padding:12px 16px;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:50}
    .back{font-size:12px;color:#64748b;text-decoration:none;display:flex;align-items:center;gap:5px}
    .nav-title{font-size:13px;font-weight:700;color:#86efac}
    .nav-sub{font-size:10px;color:#334155;margin-left:auto}

    /* PAGE */
    .page{max-width:680px;margin:0 auto;padding:20px 14px}

    /* INTRO */
    .intro{background:#0e1420;border:1px solid rgba(34,197,94,.2);border-radius:14px;padding:18px;margin-bottom:24px}
    .intro h2{font-size:17px;font-weight:800;color:#86efac;margin-bottom:8px}
    .intro p{font-size:12px;color:#94a3b8;line-height:1.7}

    /* STEP */
    .step{margin-bottom:6px;border-radius:14px;border:1px solid rgba(255,255,255,.07);background:#0e1420;overflow:hidden}
    .step.open{border-color:rgba(34,197,94,.3)}
    .step-btn{display:flex;align-items:center;gap:12px;padding:14px 16px;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;width:100%;background:none;border:none;color:inherit;text-align:left}
    .num{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;flex-shrink:0}
    .step-icon{font-size:20px;flex-shrink:0}
    .step-text{flex:1}
    .step-title{font-size:13px;font-weight:700}
    .step-hint{font-size:10px;color:#64748b;margin-top:2px}
    .caret{color:#334155;transition:transform .2s;flex-shrink:0}
    .open .caret{transform:rotate(180deg)}
    .step-body{display:none;padding:0 16px 16px;border-top:1px solid rgba(255,255,255,.05)}

    /* Body content types */
    .eli5{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.2);border-radius:10px;padding:11px 13px;font-size:11px;color:#86efac;line-height:1.6;margin-top:12px}
    .eli5 strong{font-weight:700}
    .code-block{background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:11px 13px;font-size:10.5px;font-family:'JetBrains Mono',monospace;line-height:1.75;overflow-x:auto;margin-top:10px;white-space:pre}
    .lbl{font-size:9px;font-weight:700;letter-spacing:1.4px;text-transform:uppercase;color:#334155;margin:13px 0 7px}
    .bullet{font-size:11px;color:#94a3b8;line-height:1.7;margin-top:8px}
    .bullet li{margin-bottom:3px;margin-left:16px}
    .warn{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.2);border-radius:9px;padding:10px 12px;font-size:10.5px;color:#fde68a;margin-top:10px;line-height:1.6}

    /* Colour per step */
    .s1 .num{background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff}.s1 .step-title{color:#a5b4fc}
    .s2 .num{background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff}.s2 .step-title{color:#7dd3fc}
    .s3 .num{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff}.s3 .step-title{color:#c4b5fd}
    .s4 .num{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.s4 .step-title{color:#fcd34d}
    .s5 .num{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.s5 .step-title{color:#86efac}
    .s6 .num{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.s6 .step-title{color:#6ee7b7}

    /* Syntax colours in code */
    .cmt{color:#334155}
    .key{color:#7dd3fc}
    .fn{color:#86efac}
    .str{color:#fcd34d}
    .val{color:#f9a8d4}

    /* Flow summary */
    .flow-sum{display:flex;flex-direction:column;gap:3px;margin-top:16px}
    .flow-row{display:flex;align-items:center;gap:8px;font-size:11px}
    .flow-box{border-radius:7px;padding:7px 11px;font-weight:600;font-size:11px;flex-shrink:0}
    .flow-arr{color:#1e3a5f;flex-shrink:0}

    footer{text-align:center;font-size:10px;color:#1e293b;padding:24px 14px}
  </style>
</head>
<body>

<nav class="nav">
  <a class="back" href="index.html">‚Üê Home</a>
  <span class="nav-title">‚òï Java Spring Boot Flow</span>
  <span class="nav-sub">Tap a step to expand</span>
</nav>

<div class="page">

  <!-- INTRO -->
  <div class="intro">
    <h2>ü§î What happens when you call an API?</h2>
    <p>Imagine you're the HTTP request. You're a little envelope üì® with data inside. Here's every door you must pass through before reaching the database ‚Äî and how Spring Boot handles each one.</p>
  </div>

  <!-- FULL FLOW SUMMARY (collapsed overview) -->
  <div class="lbl" style="margin-top:0">üìç Full Journey at a Glance</div>
  <div style="background:#0e1420;border:1px solid rgba(255,255,255,.07);border-radius:12px;padding:14px;margin-bottom:20px;font-size:11px;line-height:2;color:#64748b">
    <span style="color:#a5b4fc">üåê Browser/Postman</span>
    ‚Üí <span style="color:#7dd3fc">CORS Check</span>
    ‚Üí <span style="color:#c4b5fd">SecurityFilterChain</span>
    ‚Üí <span style="color:#fcd34d">JwtAuthFilter</span>
    ‚Üí <span style="color:#86efac">Controller</span>
    ‚Üí <span style="color:#6ee7b7">Service</span>
    ‚Üí <span style="color:#5eead4">Repository (JPA)</span>
    ‚Üí <span style="color:#7dd3fc">MySQL DB</span>
    ‚Üí üîÑ <span style="color:#94a3b8">same path reversed ‚Üí JSON Response</span>
  </div>

  <!-- STEPS -->

  <!-- 1 -->
  <div class="step s1 open" id="s1">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">1</div>
      <span class="step-icon">üåê</span>
      <div class="step-text">
        <div class="step-title">Request Arrives</div>
        <div class="step-hint">Your app or Postman sends an HTTP request</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5">
        <strong>In simple words:</strong> Someone types a URL or clicks a button. The browser packages it as a request: method (GET/POST), URL, headers, and body (JSON). This hits your Spring Boot server on port 8080.
      </div>
      <div class="lbl">Example Requests</div>
      <div class="code-block"><span class="cmt">// Public ‚Äî no token needed</span>
<span class="key">POST</span> http://localhost:8080/auth/login
Content-Type: application/json
{ "email": "user@b.com", "password": "pass123" }

<span class="cmt">// Protected ‚Äî needs token</span>
<span class="key">GET</span> http://localhost:8080/api/tours
Authorization: Bearer eyJhbGci...</div>
    </div>
  </div>

  <!-- 2 -->
  <div class="step s2" id="s2">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">2</div>
      <span class="step-icon">üö¶</span>
      <div class="step-text">
        <div class="step-title">CORS Check</div>
        <div class="step-hint">CorsConfig.java ‚Äî "Is this request from an allowed website?"</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5">
        <strong>In simple words:</strong> CORS is a browser security rule. If your React app is on <code>localhost:3000</code> but your API is on <code>localhost:8080</code>, the browser will block it ‚Äî unless your backend explicitly says "I allow requests from 3000". That's what <code>CorsConfig.java</code> does.
      </div>
      <div class="lbl">CorsConfig.java</div>
      <div class="code-block"><span class="cmt">// Allows frontend to call our API</span>
config.setAllowedOrigins(List.of(<span class="str">"http://localhost:3000"</span>, <span class="str">"*"</span>));
config.setAllowedMethods(List.of(<span class="str">"GET"</span>, <span class="str">"POST"</span>, <span class="str">"PUT"</span>, <span class="str">"DELETE"</span>));
config.setAllowedHeaders(List.of(<span class="str">"*"</span>));</div>
    </div>
  </div>

  <!-- 3 -->
  <div class="step s3" id="s3">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">3</div>
      <span class="step-icon">üõ°Ô∏è</span>
      <div class="step-text">
        <div class="step-title">Spring Security Filter Chain</div>
        <div class="step-hint">SecurityConfig.java ‚Äî "Should this route be public or protected?"</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5">
        <strong>In simple words:</strong> Before any controller handles the request, Spring Security acts like a security guard. It checks a rulebook (<code>SecurityConfig.java</code>): "Is this route allowed without a login?" or "Must the user be logged in?"
      </div>
      <div class="lbl">SecurityConfig.java ‚Äî the rulebook</div>
      <div class="code-block"><span class="cmt">// Routes starting with /auth ‚Üí ANYONE can access</span>
.requestMatchers(<span class="str">"/auth/**"</span>).permitAll()

<span class="cmt">// All other routes ‚Üí currently also open</span>
<span class="cmt">// (to enable auth: change to .authenticated())</span>
.anyRequest().permitAll()

<span class="cmt">// NO sessions ‚Äî server doesn't remember you</span>
<span class="cmt">// Every request MUST carry the JWT token</span>
.sessionCreationPolicy(SessionCreationPolicy.STATELESS)

<span class="cmt">// Register the JWT filter to run here</span>
.addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class)</div>
      <div class="warn">‚öë Because it's <strong>STATELESS</strong>, the server has no memory between requests. Every API call must send the JWT token again ‚Äî like showing your ID card every time you enter a building.</div>
    </div>
  </div>

  <!-- 4 -->
  <div class="step s4" id="s4">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">4</div>
      <span class="step-icon">üîë</span>
      <div class="step-text">
        <div class="step-title">JwtAuthFilter</div>
        <div class="step-hint">JwtAuthFilter.java ‚Äî reads the token from the header</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5">
        <strong>In simple words:</strong> This filter runs on <em>every single request</em>. It looks at the <code>Authorization</code> header. If it finds a valid JWT token, it "signs in" the user in Spring's memory (SecurityContext) so the controller knows who's making the request.
      </div>
      <div class="lbl">JwtAuthFilter.java ‚Äî step by step</div>
      <div class="code-block"><span class="cmt">// Step 1 ‚Äî Read the Authorization header</span>
String header = request.getHeader(<span class="str">"Authorization"</span>);

<span class="cmt">// Step 2 ‚Äî Token is after "Bearer " (7 characters)</span>
<span class="key">if</span> (header != null &amp;&amp; header.startsWith(<span class="str">"Bearer "</span>)) {
  String token = header.substring(7);

  <span class="cmt">// Step 3 ‚Äî Decode the token</span>
  String username = jwtUtil.<span class="fn">extractUsername</span>(token); <span class="cmt">// email</span>
  String role     = jwtUtil.<span class="fn">extractRole</span>(token);     <span class="cmt">// CUSTOMER/admin</span>

  <span class="cmt">// Step 4 ‚Äî Tell Spring "this user is logged in"</span>
  UsernamePasswordAuthenticationToken auth =
    new UsernamePasswordAuthenticationToken(username, null,
      List.of(new SimpleGrantedAuthority(<span class="str">"ROLE_"</span> + role)));
  SecurityContextHolder.getContext().<span class="fn">setAuthentication</span>(auth);
}
<span class="cmt">// Step 5 ‚Äî Continue to the next filter/controller</span>
chain.<span class="fn">doFilter</span>(request, response);</div>
    </div>
  </div>

  <!-- 5 -->
  <div class="step s5" id="s5">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">5</div>
      <span class="step-icon">üéÆ</span>
      <div class="step-text">
        <div class="step-title">Controller</div>
        <div class="step-hint">@RestController ‚Äî receives the request, calls Service</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5">
        <strong>In simple words:</strong> The controller is like a receptionist. It receives the request, decides which department (service) should handle it, and then returns the answer to the caller. It should NOT do any database or business logic itself.
      </div>
      <div class="lbl">Controllers and their routes</div>
      <div style="background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:12px;margin-top:0;font-size:10.5px;line-height:2">
        <div><span style="color:#a5b4fc">AuthController</span>  ‚Üí <code>/auth/**</code> ‚Äî register, login, forgot password</div>
        <div><span style="color:#7dd3fc">TourController</span> ‚Üí <code>/api/tours/**</code> ‚Äî list, search tours</div>
        <div><span style="color:#fcd34d">BookingController</span> ‚Üí <code>/api/bookings/**</code> ‚Äî create booking</div>
        <div><span style="color:#86efac">PassengerController</span> ‚Üí <code>/api/passengers/**</code> ‚Äî add PAX</div>
        <div><span style="color:#fda4af">PaymentController</span> ‚Üí <code>/api/payments/**</code> ‚Äî save payment</div>
      </div>
      <div class="lbl">AuthController.java ‚Äî login endpoint</div>
      <div class="code-block"><span class="key">@PostMapping</span>(<span class="str">"/login"</span>)     <span class="cmt">// maps to POST /auth/login</span>
<span class="key">public</span> ResponseEntity login(<span class="key">@RequestBody</span> LoginDTO dto) {
  <span class="cmt">// 1. Pass to service ‚Äî controller doesn't do logic</span>
  String token = authService.<span class="fn">login</span>(dto);

  <span class="cmt">// 2. Build JSON response</span>
  Map response = new HashMap();
  response.put(<span class="str">"token"</span>, token);

  <span class="cmt">// 3. Return 200 OK with the token</span>
  <span class="key">return</span> ResponseEntity.ok(response);
}</div>
    </div>
  </div>

  <!-- 6 -->
  <div class="step s6" id="s6">
    <button class="step-btn" onclick="tog(this)">
      <div class="num">6</div>
      <span class="step-icon">‚öôÔ∏è</span>
      <div class="step-text">
        <div class="step-title">Service ‚Üí Repository ‚Üí MySQL</div>
        <div class="step-hint">Business logic ‚Üí Spring Data JPA ‚Üí SQL query</div>
      </div>
      <span class="caret">‚ñº</span>
    </button>
    <div class="step-body">
      <div class="eli5">
        <strong>In simple words:</strong> The Service does the actual thinking. It validates data, checks passwords, creates tokens. Then it asks the Repository (think of it as the DB helper) to run the SQL. The Repository speaks JPA ‚Äî you write Java methods, Spring auto-generates the SQL.
      </div>
      <div class="lbl">AuthService.java ‚Äî login logic</div>
      <div class="code-block"><span class="key">public</span> String <span class="fn">login</span>(LoginDTO dto) {
  <span class="cmt">// 1. Find user in DB by email</span>
  CustomerModel customer =
    customerRepository.<span class="fn">findByEmail</span>(dto.getEmail());
  <span class="cmt">// ‚Üë Spring Data JPA runs: SELECT * FROM customer_master WHERE email=?</span>

  <span class="cmt">// 2. Check if password matches (BCrypt hash check)</span>
  BCryptPasswordEncoder.<span class="fn">matches</span>(dto.getPassword(), customer.getPassword());

  <span class="cmt">// 3. Build and return JWT token</span>
  <span class="key">return</span> jwtUtil.<span class="fn">generateToken</span>(customer.getEmail(), customer.getRole());
}</div>
      <div class="lbl">The response travels BACK the same path</div>
      <div style="font-size:11px;color:#64748b;line-height:2;margin-top:6px">
        MySQL result ‚Üí Repository returns Entity ‚Üí Service maps to DTO ‚Üí Controller wraps in <code>ResponseEntity.ok()</code> ‚Üí Spring/Jackson converts to JSON ‚Üí HTTP 200 Response ‚Üí Browser
      </div>
    </div>
  </div>

</div><!-- /page -->

<footer><a href="index.html" style="color:#334155;text-decoration:none">‚Üê Back to Home</a> &nbsp;¬∑&nbsp; BackEnd_Java ¬∑ Spring Boot ¬∑ Spring Security ¬∑ JJWT</footer>

<script>
  function tog(btn){
    const s=btn.closest('.step');
    s.classList.toggle('open');
  }
</script>
</body>
</html>
