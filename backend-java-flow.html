<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Java Spring Boot ‚Äî Full Request Flow</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:#080c14;color:#e2e8f0;min-height:100vh;-webkit-font-smoothing:antialiased;padding-bottom:60px}
code{font-family:'JetBrains Mono',monospace;font-size:.88em;background:rgba(255,255,255,.09);padding:1px 5px;border-radius:4px}
.nav{background:#0a0f1c;border-bottom:1px solid rgba(255,255,255,.07);padding:11px 16px;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:50}
.back{font-size:12px;color:#64748b;text-decoration:none}
.nav-title{font-size:13px;font-weight:700;color:#86efac}
.nav-hint{font-size:10px;color:#334155;margin-left:auto}
.pills{display:flex;gap:6px;overflow-x:auto;padding:9px 14px;background:#0a0f1c;border-bottom:1px solid rgba(255,255,255,.06);scrollbar-width:none}
.pills::-webkit-scrollbar{display:none}
.pill{flex-shrink:0;font-size:10px;font-weight:700;padding:4px 11px;border-radius:20px;text-decoration:none;white-space:nowrap;border:1px solid transparent}
.page{max-width:720px;margin:0 auto;padding:18px 14px}
.intro{background:#0e1420;border:1px solid rgba(34,197,94,.25);border-radius:14px;padding:16px;margin-bottom:16px}
.intro h2{font-size:15px;font-weight:800;color:#86efac;margin-bottom:6px}
.intro p{font-size:12px;color:#94a3b8;line-height:1.7}
.step{margin-bottom:5px;border-radius:14px;border:1px solid rgba(255,255,255,.07);background:#0e1420;overflow:hidden}
.step.open{border-color:var(--sc,rgba(34,197,94,.3))}
.step-btn{display:flex;align-items:center;gap:12px;padding:13px 16px;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;width:100%;background:none;border:none;color:inherit;text-align:left}
.num{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;flex-shrink:0}
.sico{font-size:19px;flex-shrink:0}
.si{flex:1;min-width:0}
.st{font-size:13px;font-weight:700}
.ss{font-size:10px;color:#64748b;margin-top:2px}
.caret{color:#334155;font-size:12px;transition:transform .2s;flex-shrink:0}
.open .caret{transform:rotate(180deg)}
.sb{display:none;padding:0 16px 16px;border-top:1px solid rgba(255,255,255,.05)}
.open .sb{display:block}
.eli5{border-radius:10px;padding:10px 13px;font-size:11px;line-height:1.65;margin-top:12px}
.lbl{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#334155;margin:13px 0 6px}
.cb{background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;padding:11px 13px;font-size:10.5px;font-family:'JetBrains Mono',monospace;line-height:1.75;overflow-x:auto;white-space:pre}
.warn{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.2);border-radius:9px;padding:10px 12px;font-size:10.5px;color:#fde68a;margin-top:8px;line-height:1.6}
.ok{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.2);border-radius:9px;padding:10px 12px;font-size:10.5px;color:#86efac;margin-top:8px;line-height:1.6}
.tblw{background:#111827;border:1px solid rgba(255,255,255,.07);border-radius:9px;overflow:hidden;margin-top:0}
.tbl{width:100%;border-collapse:collapse;font-size:10px}
.tbl th{text-align:left;padding:5px 9px;border-bottom:1px solid rgba(255,255,255,.08);font-size:9px;text-transform:uppercase;letter-spacing:1px;font-weight:700;color:#334155}
.tbl td{padding:5px 9px;border-bottom:1px solid rgba(255,255,255,.03);color:#94a3b8;vertical-align:top;line-height:1.5}
.tbl td:first-child{color:#e2e8f0;font-family:'JetBrains Mono',monospace;font-size:9.5px}
.s1{--sc:rgba(99,102,241,.35)}.s1 .num{background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff}.s1 .st{color:#a5b4fc}.s1 .eli5{background:rgba(99,102,241,.07);border:1px solid rgba(99,102,241,.2);color:#c4b5fd}
.s2{--sc:rgba(14,165,233,.35)}.s2 .num{background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff}.s2 .st{color:#7dd3fc}.s2 .eli5{background:rgba(14,165,233,.07);border:1px solid rgba(14,165,233,.2);color:#7dd3fc}
.s3{--sc:rgba(139,92,246,.35)}.s3 .num{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff}.s3 .st{color:#c4b5fd}.s3 .eli5{background:rgba(139,92,246,.07);border:1px solid rgba(139,92,246,.2);color:#c4b5fd}
.s4{--sc:rgba(245,158,11,.35)}.s4 .num{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}.s4 .st{color:#fcd34d}.s4 .eli5{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.2);color:#fde68a}
.s5{--sc:rgba(34,197,94,.35)}.s5 .num{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.s5 .st{color:#86efac}.s5 .eli5{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.2);color:#86efac}
.s6{--sc:rgba(16,185,129,.35)}.s6 .num{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.s6 .st{color:#6ee7b7}.s6 .eli5{background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.2);color:#6ee7b7}
.cmt{color:#374151}.key{color:#7dd3fc}.fn{color:#86efac}.str{color:#fcd34d}.ann{color:#fb923c}
footer{text-align:center;font-size:10px;color:#1e293b;padding:22px 14px}
</style>
</head>
<body>
<nav class="nav">
  <a class="back" href="index.html">‚Üê Home</a>
  <span class="nav-title">‚òï Java Spring Boot ‚Äî Full Flow</span>
  <span class="nav-hint">Tap to expand</span>
</nav>
<div class="pills">
  <a class="pill" href="#s1" style="background:rgba(99,102,241,.18);color:#a5b4fc;border-color:rgba(99,102,241,.35)">1¬∑Request</a>
  <a class="pill" href="#s2" style="background:rgba(14,165,233,.16);color:#7dd3fc;border-color:rgba(14,165,233,.32)">2¬∑CORS</a>
  <a class="pill" href="#s3" style="background:rgba(139,92,246,.18);color:#c4b5fd;border-color:rgba(139,92,246,.35)">3¬∑Security</a>
  <a class="pill" href="#s4" style="background:rgba(245,158,11,.16);color:#fcd34d;border-color:rgba(245,158,11,.32)">4¬∑JwtFilter</a>
  <a class="pill" href="#s5" style="background:rgba(34,197,94,.16);color:#86efac;border-color:rgba(34,197,94,.32)">5¬∑Controller</a>
  <a class="pill" href="#s6" style="background:rgba(16,185,129,.16);color:#6ee7b7;border-color:rgba(16,185,129,.32)">6¬∑Service+DB</a>
</div>
<div class="page">

<div class="intro">
  <h2>ü§î What happens when you call a Java API?</h2>
  <p>Every request travels through 6 layers before reaching the database. Each step below has a plain-English explanation <b>AND</b> the full actual code from the project. Tap any step to expand it.</p>
</div>

<!-- STACK OVERVIEW -->
<div class="lbl" style="margin-top:0">üìå Stack Overview</div>
<div class="tblw" style="margin-bottom:14px">
  <table class="tbl">
    <tr><th>Layer / File</th><th>What it does</th></tr>
    <tr><td>CorsConfig.java</td><td>Allows frontend domain to call API cross-origin</td></tr>
    <tr><td>SecurityConfig.java</td><td>Defines public vs protected routes, registers JWT filter, enables OAuth</td></tr>
    <tr><td>JwtAuthFilter.java</td><td>Reads Authorization header, validates JWT, sets SecurityContext</td></tr>
    <tr><td>JwtUtil.java</td><td>generateToken / generateResetToken / extractUsername / extractRole</td></tr>
    <tr><td>AuthController.java</td><td>Routes /auth/** ‚Äî register, login, forgot/reset password</td></tr>
    <tr><td>AuthService.java</td><td>Business logic ‚Äî BCrypt check, token generation</td></tr>
    <tr><td>*Repository.java</td><td>Spring Data JPA ‚Äî auto-converts Java method calls to SQL</td></tr>
  </table>
</div>

<!-- FLOW SUMMARY -->
<div style="background:#0e1420;border:1px solid rgba(255,255,255,.07);border-radius:12px;padding:13px 15px;margin-bottom:14px;font-size:11px;color:#64748b;line-height:2">
  <b style="color:#a5b4fc">üåê Request</b> ‚Üí <span style="color:#7dd3fc">CORS</span> ‚Üí <span style="color:#c4b5fd">SecurityFilterChain</span> ‚Üí <span style="color:#fcd34d">JwtAuthFilter</span> ‚Üí <span style="color:#86efac">Controller</span> ‚Üí <span style="color:#6ee7b7">Service</span> ‚Üí <span style="color:#5eead4">JPA Repository</span> ‚Üí <b style="color:#7dd3fc">MySQL</b><br/>
  <b style="color:#94a3b8">‚Ü© Back:</b> MySQL ‚Üí Entity ‚Üí DTO ‚Üí ResponseEntity.ok(dto) ‚Üí Jackson ‚Üí JSON ‚Üí Browser
</div>

<!-- S1 -->
<div class="step s1 open" id="s1">
  <button class="step-btn" onclick="tog(this)">
    <div class="num">1</div><span class="sico">üåê</span>
    <div class="si"><div class="st">HTTP Request Arrives</div><div class="ss">Frontend / Postman sends JSON to port 8080</div></div>
    <span class="caret">‚ñº</span>
  </button>
  <div class="sb">
    <div class="eli5"><b>In simple words:</b> Every action (login, get tours, book a tour) is packaged as an HTTP request ‚Äî it has a METHOD (GET/POST), a URL, headers like Authorization, and a JSON body. This hits Spring Boot on port 8080.</div>
    <div class="lbl">Example ‚Äî Public vs Protected</div>
    <div class="cb"><span class="cmt">// ‚ë† Public ‚Äî no token needed</span>
<span class="key">POST</span> http://localhost:8080/auth/login
Content-Type: application/json
{ "email": "user@b.com", "password": "pass123" }

<span class="cmt">// ‚ë° Protected ‚Äî must include JWT</span>
<span class="key">GET</span> http://localhost:8080/api/tours
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...

<span class="cmt">// ‚ë¢ Protected ‚Äî create booking</span>
<span class="key">POST</span> http://localhost:8080/api/bookings
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...
{ "tourId": 5, "departureId": 2, "customerId": 10 }</div>
  </div>
</div>

<!-- S2 -->
<div class="step s2" id="s2">
  <button class="step-btn" onclick="tog(this)">
    <div class="num">2</div><span class="sico">üåç</span>
    <div class="si"><div class="st">CORS Check</div><div class="ss">CorsConfig.java ‚Äî "Is request from an allowed origin?"</div></div>
    <span class="caret">‚ñº</span>
  </button>
  <div class="sb">
    <div class="eli5"><b>In simple words:</b> If React runs on <code>localhost:3000</code> and API on <code>localhost:8080</code>, browsers block it unless the server says "I allow 3000". Postman ignores CORS ‚Äî only browsers enforce it. <code>CorsConfig.java</code> adds the allow headers.</div>
    <div class="lbl">CorsConfig.java</div>
    <div class="cb"><span class="ann">@Bean</span>
CorsConfigurationSource corsConfigurationSource() {
  CorsConfiguration config = <span class="key">new</span> CorsConfiguration();
  config.setAllowedOrigins(List.of(<span class="str">"http://localhost:3000"</span>, <span class="str">"*"</span>));
  config.setAllowedMethods(List.of(<span class="str">"GET"</span>,<span class="str">"POST"</span>,<span class="str">"PUT"</span>,<span class="str">"DELETE"</span>,<span class="str">"OPTIONS"</span>));
  config.setAllowedHeaders(List.of(<span class="str">"*"</span>));    <span class="cmt">// allow Authorization header</span>
  config.setAllowCredentials(<span class="key">true</span>);
  UrlBasedCorsConfigurationSource src = <span class="key">new</span> UrlBasedCorsConfigurationSource();
  src.registerCorsConfiguration(<span class="str">"/**"</span>, config); <span class="cmt">// apply to all routes</span>
  <span class="key">return</span> src;
}</div>
    <div class="warn">‚öë CORS error = browser blocks, not the server. Postman still works. Check browser console for <code>Access-Control-Allow-Origin</code> error.</div>
  </div>
</div>

<!-- S3 -->
<div class="step s3" id="s3">
  <button class="step-btn" onclick="tog(this)">
    <div class="num">3</div><span class="sico">üõ°Ô∏è</span>
    <div class="si"><div class="st">Spring Security ‚Äî FilterChain</div><div class="ss">SecurityConfig.java ‚Äî public vs protected, registers JWT filter</div></div>
    <span class="caret">‚ñº</span>
  </button>
  <div class="sb">
    <div class="eli5"><b>In simple words:</b> The main security rulebook. Before any controller runs, Spring Security checks: "Is this route allowed without login (public) or must the user be authenticated?" It also sets the app as STATELESS (no sessions ‚Äî every request must carry a token) and plugs in our JWT filter.</div>
    <div class="lbl">SecurityConfig.java ‚Äî complete filterChain()</div>
    <div class="cb"><span class="ann">@Bean</span>
SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
  http
    <span class="cmt">// ‚ë† Disable CSRF ‚Äî not needed for JWT APIs</span>
    .csrf(csrf -> csrf.disable())
    <span class="cmt">// ‚ë° Disable form login ‚Äî we use JWT, not session cookies</span>
    .formLogin(form -> form.disable())
    <span class="cmt">// ‚ë¢ Route access rules</span>
    .authorizeHttpRequests(auth -> auth
      .requestMatchers(<span class="str">"/auth/**"</span>).permitAll()   <span class="cmt">// PUBLIC</span>
      .requestMatchers(<span class="str">"/oauth2/**"</span>).permitAll()  <span class="cmt">// Google OAuth</span>
      .anyRequest().permitAll()                <span class="cmt">// currently all open</span>
    )
    <span class="cmt">// ‚ë£ Stateless ‚Äî server keeps ZERO session state</span>
    .sessionManagement(s ->
      s.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
    <span class="cmt">// ‚ë§ Our JWT filter runs BEFORE Spring's built-in auth filter</span>
    .addFilterBefore(jwtAuthFilter,
      UsernamePasswordAuthenticationFilter.class)
    <span class="cmt">// ‚ë• Google OAuth2 support</span>
    .oauth2Login(o -> o.successHandler(oAuth2SuccessHandler));
  <span class="key">return</span> http.build();
}</div>
    <div class="warn">‚öë <b>STATELESS</b> means the server has zero memory between requests. Every API call MUST resend the JWT ‚Äî like showing your ID card every time you enter a room, even if you just left.</div>
  </div>
</div>

<!-- S4 -->
<div class="step s4" id="s4">
  <button class="step-btn" onclick="tog(this)">
    <div class="num">4</div><span class="sico">üîë</span>
    <div class="si"><div class="st">JwtAuthFilter + JwtUtil</div><div class="ss">Reads header ‚Üí validates ‚Üí extracts ‚Üí sets SecurityContext</div></div>
    <span class="caret">‚ñº</span>
  </button>
  <div class="sb">
    <div class="eli5"><b>In simple words:</b> Runs on EVERY request. Reads the <code>Authorization: Bearer &lt;token&gt;</code> header. If token is valid, it decodes email + role and "signs in" the user in Spring's memory so controllers know who's calling.</div>
    <div class="lbl">JwtAuthFilter.java ‚Äî doFilterInternal()</div>
    <div class="cb"><span class="key">protected void</span> <span class="fn">doFilterInternal</span>(
    HttpServletRequest req, HttpServletResponse res, FilterChain chain) {

  <span class="cmt">// 1. Read header</span>
  String header = req.getHeader(<span class="str">"Authorization"</span>);

  <span class="key">if</span> (header != <span class="key">null</span> &amp;&amp; header.startsWith(<span class="str">"Bearer "</span>)) {
    String token = header.substring(7);  <span class="cmt">// strip "Bearer "</span>

    <span class="cmt">// 2. Decode claims from JWT</span>
    String username = jwtUtil.<span class="fn">extractUsername</span>(token); <span class="cmt">// = email (sub)</span>
    String role     = jwtUtil.<span class="fn">extractRole</span>(token);     <span class="cmt">// = CUSTOMER</span>

    <span class="cmt">// 3. Create Spring authentication object</span>
    UsernamePasswordAuthenticationToken authToken =
      <span class="key">new</span> UsernamePasswordAuthenticationToken(
        username, <span class="key">null</span>,
        List.of(<span class="key">new</span> SimpleGrantedAuthority(<span class="str">"ROLE_"</span> + role)));

    <span class="cmt">// 4. Tell Spring "this user is authenticated"</span>
    SecurityContextHolder.getContext().<span class="fn">setAuthentication</span>(authToken);
  }
  chain.<span class="fn">doFilter</span>(req, res); <span class="cmt">// ALWAYS continue to next layer</span>
}</div>
    <div class="lbl">JwtUtil.java ‚Äî token generation + extraction</div>
    <div class="cb"><span class="cmt">// Shared key ‚Äî same string used in .NET!</span>
<span class="key">private final</span> Key secretKey = Keys.hmacShaKeyFor(
  <span class="str">"MySecretKeyForJwt123456789012345"</span>.getBytes());

<span class="cmt">// Login token ‚Äî 24 hour expiry</span>
<span class="key">public</span> String <span class="fn">generateToken</span>(String email, String role) {
  <span class="key">return</span> Jwts.builder()
    .setSubject(email)          <span class="cmt">// "sub" claim</span>
    .claim(<span class="str">"role"</span>, role)         <span class="cmt">// custom claim</span>
    .setIssuedAt(<span class="key">new</span> Date())
    .setExpiration(<span class="key">new</span> Date(System.currentTimeMillis() + 86400000)) <span class="cmt">// 24h</span>
    .signWith(secretKey, SignatureAlgorithm.HS256)
    .compact();
}

<span class="cmt">// Reset token ‚Äî only 15 minutes!</span>
<span class="key">public</span> String <span class="fn">generateResetToken</span>(String email) {
  <span class="key">return</span> Jwts.builder()
    .setSubject(email)
    .claim(<span class="str">"type"</span>, <span class="str">"RESET_PASSWORD"</span>)
    .setExpiration(<span class="key">new</span> Date(System.currentTimeMillis() + 900000)) <span class="cmt">// 15min</span>
    .signWith(secretKey, SignatureAlgorithm.HS256).compact();
}

<span class="key">public</span> String  <span class="fn">extractUsername</span>(String t){ <span class="key">return</span> getClaims(t).getSubject(); }
<span class="key">public</span> String  <span class="fn">extractRole</span>(String t)    { <span class="key">return</span> getClaims(t).get(<span class="str">"role"</span>,String.class); }
<span class="key">public boolean</span> <span class="fn">isTokenValid</span>(String t)   { <span class="key">try</span>{getClaims(t);<span class="key">return true</span>;}catch(Exception e){<span class="key">return false</span>;} }</div>
  </div>
</div>

<!-- S5 -->
<div class="step s5" id="s5">
  <button class="step-btn" onclick="tog(this)">
    <div class="num">5</div><span class="sico">üéÆ</span>
    <div class="si"><div class="st">Controller Layer</div><div class="ss">@RestController ‚Äî maps HTTP routes, delegates logic to Service</div></div>
    <span class="caret">‚ñº</span>
  </button>
  <div class="sb">
    <div class="eli5"><b>In simple words:</b> The receptionist. It receives the HTTP request, maps it to the right method by route + HTTP method, delegates ALL logic to the Service, and formats the HTTP response (200, 401, 400). No business logic here.</div>
    <div class="lbl">All Controllers</div>
    <div class="tblw">
      <table class="tbl">
        <tr><th>Controller</th><th>Route</th><th>Key Endpoints</th></tr>
        <tr><td>AuthController</td><td>/auth/**</td><td>POST /register, /login, /forgot-password, /reset-password</td></tr>
        <tr><td>TourController</td><td>/api/tours/**</td><td>GET /all, GET /{id}, GET /scheduled, GET /search</td></tr>
        <tr><td>CategoryController</td><td>/api/categories/**</td><td>GET /all, GET /sub/{catCode}</td></tr>
        <tr><td>BookingController</td><td>/api/bookings/**</td><td>POST /, GET /customer/{id}, GET /{id}</td></tr>
        <tr><td>PassengerController</td><td>/api/passengers/**</td><td>POST /add, GET /booking/{id}</td></tr>
        <tr><td>PaymentController</td><td>/api/payments/**</td><td>POST /create, GET /booking/{id}</td></tr>
        <tr><td>SearchController</td><td>/api/search/**</td><td>GET /?q={query}</td></tr>
        <tr><td>CustomerController</td><td>/api/customers/**</td><td>GET /profile, PUT /update</td></tr>
      </table>
    </div>
    <div class="lbl">AuthController.java ‚Äî all 4 auth endpoints</div>
    <div class="cb"><span class="ann">@RestController</span>
<span class="ann">@RequestMapping</span>(<span class="str">"/auth"</span>)
<span class="key">public class</span> AuthController {

  <span class="ann">@PostMapping</span>(<span class="str">"/register"</span>)
  ResponseEntity register(<span class="ann">@RequestBody</span> RegisterDTO dto) {
    String msg = authService.<span class="fn">register</span>(dto);
    <span class="key">return</span> ResponseEntity.ok(Map.of(<span class="str">"message"</span>, msg));
  }

  <span class="ann">@PostMapping</span>(<span class="str">"/login"</span>)
  ResponseEntity login(<span class="ann">@RequestBody</span> LoginDTO dto) {
    String token = authService.<span class="fn">login</span>(dto);
    <span class="key">return</span> ResponseEntity.ok(Map.of(<span class="str">"token"</span>, token));
    <span class="cmt">// ‚Üí 200 {"token": "eyJhbGci..."}</span>
  }

  <span class="ann">@PostMapping</span>(<span class="str">"/forgot-password"</span>)
  ResponseEntity forgotPassword(<span class="ann">@RequestBody</span> ForgotPasswordDTO dto) {
    authService.<span class="fn">forgotPassword</span>(dto.getEmail()); <span class="cmt">// sends email with 15-min link</span>
    <span class="key">return</span> ResponseEntity.ok(Map.of(<span class="str">"message"</span>, <span class="str">"Reset link sent"</span>));
  }

  <span class="ann">@PostMapping</span>(<span class="str">"/reset-password"</span>)
  ResponseEntity resetPassword(<span class="ann">@RequestBody</span> ResetPasswordDTO dto) {
    authService.<span class="fn">resetPassword</span>(dto); <span class="cmt">// validates reset token, saves new hash</span>
    <span class="key">return</span> ResponseEntity.ok(Map.of(<span class="str">"message"</span>, <span class="str">"Password updated"</span>));
  }
}</div>
    <div class="lbl">How a controller reads WHO is logged in</div>
    <div class="cb"><span class="cmt">// Spring injects Authentication from SecurityContextHolder (set by JwtAuthFilter)</span>
<span class="ann">@GetMapping</span>(<span class="str">"/my-bookings"</span>)
ResponseEntity getMyBookings(Authentication auth) {
  String email = auth.getName();  <span class="cmt">// = JWT "sub" (email)</span>
  <span class="cmt">// auth.getAuthorities() = ["ROLE_CUSTOMER"] or ["ROLE_admin"]</span>
  <span class="key">return</span> ResponseEntity.ok(bookingService.<span class="fn">getByEmail</span>(email));
}</div>
  </div>
</div>

<!-- S6 -->
<div class="step s6" id="s6">
  <button class="step-btn" onclick="tog(this)">
    <div class="num">6</div><span class="sico">‚öôÔ∏è</span>
    <div class="si"><div class="st">Service ‚Üí Repository ‚Üí MySQL ‚Üí Response</div><div class="ss">Business logic ‚Üí JPA auto-SQL ‚Üí entity ‚Üí DTO ‚Üí JSON back</div></div>
    <span class="caret">‚ñº</span>
  </button>
  <div class="sb">
    <div class="eli5"><b>In simple words:</b> Service does real work ‚Äî BCrypt password check, JWT generation, cost calculation. It asks Repository to talk to DB. Spring Data JPA converts Java method names like <code>findByEmail()</code> into SQL automatically. Results come back as entities, get mapped to DTOs, and the controller returns them as JSON.</div>
    <div class="lbl">AuthService.java ‚Äî full login() logic</div>
    <div class="cb"><span class="key">public</span> String <span class="fn">login</span>(LoginDTO dto) {
  <span class="cmt">// 1. Query DB by email</span>
  CustomerModel cust = customerRepository.<span class="fn">findByEmail</span>(dto.getEmail());
  <span class="cmt">// ‚Üí JPA runs: SELECT * FROM customer_master WHERE email = ?</span>

  <span class="key">if</span> (cust == <span class="key">null</span>) <span class="key">throw new</span> RuntimeException(<span class="str">"User not found"</span>);

  <span class="cmt">// 2. Verify BCrypt password hash</span>
  <span class="key">if</span> (!BCryptPasswordEncoder.<span class="fn">matches</span>(dto.getPassword(), cust.getPassword()))
    <span class="key">throw new</span> RuntimeException(<span class="str">"Invalid password"</span>);

  <span class="cmt">// 3. Generate JWT with email + role</span>
  <span class="key">return</span> jwtUtil.<span class="fn">generateToken</span>(cust.getEmail(), cust.getRole());
}</div>
    <div class="lbl">All Repositories ‚Üí DB Tables</div>
    <div class="tblw">
      <table class="tbl">
        <tr><th>Repository</th><th>Entity</th><th>DB Table</th></tr>
        <tr><td>CustomerRepository</td><td>CustomerModel</td><td>customer_master</td></tr>
        <tr><td>TourRepository</td><td>TourMaster</td><td>tour_master</td></tr>
        <tr><td>CategoryRepository</td><td>CategoryMaster</td><td>category_master</td></tr>
        <tr><td>DepartureRepository</td><td>DepartureMaster</td><td>departure_master</td></tr>
        <tr><td>BookingRepository</td><td>BookingHeader</td><td>booking_header</td></tr>
        <tr><td>PassengerRepository</td><td>Passenger</td><td>passenger</td></tr>
        <tr><td>PaymentRepository</td><td>PaymentMaster</td><td>payment_master</td></tr>
        <tr><td>BookingStatusRepository</td><td>BookingStatusMaster</td><td>booking_status_master</td></tr>
      </table>
    </div>
    <div class="lbl">Spring Data JPA ‚Äî how SQL is auto-generated</div>
    <div class="cb"><span class="cmt">// In Repository interface you write:</span>
CustomerModel <span class="fn">findByEmail</span>(String email);
List&lt;BookingHeader&gt; <span class="fn">findByCustomerId</span>(Long id);
List&lt;TourMaster&gt; <span class="fn">findByCategoryCode</span>(String code);

<span class="cmt">// JPA generates SQL automatically:</span>
<span class="cmt">-- SELECT * FROM customer_master WHERE email = ?</span>
<span class="cmt">-- SELECT * FROM booking_header WHERE customer_id = ?</span>
<span class="cmt">-- SELECT * FROM tour_master WHERE category_code = ?</span></div>
    <div class="ok">‚úÖ <b>Response path:</b> MySQL ‚Üí JPA Entity ‚Üí Service maps to DTO ‚Üí Controller wraps in <code>ResponseEntity.ok(dto)</code> ‚Üí Jackson ‚Üí JSON ‚Üí HTTP 200 ‚Üí Browser/App</div>
  </div>
</div>

</div>
<footer><a href="index.html" style="color:#334155;text-decoration:none">‚Üê Back to Home</a> &nbsp;¬∑&nbsp; Java ¬∑ Spring Boot ¬∑ Spring Security ¬∑ JJWT ¬∑ MySQL</footer>
<script>function tog(b){b.closest('.step').classList.toggle('open')}</script>
</body>
</html>
